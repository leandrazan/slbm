B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "both")
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "both")
bootres
estim_Kblock
# RL estimated on kblock sample
rlhat_Kblock <- slbm::compute_rl(theta = estim_Kblock$mle,
Tyrl = Tyrl, type = type, ref_gmst = ref_gmst, rel_trend = add.args$rel_trend)
add.args <- list(...)
# RL estimated on kblock sample
rlhat_Kblock <- slbm::compute_rl(theta = estim_Kblock$mle,
Tyrl = Tyrl, type = type, ref_gmst = ref_gmst, rel_trend = add.args$rel_trend)
rlhat_Kblock
bootres <- purrr::map(bootres, ~ dplyr::rename(.x, "rlboot" = "rl"))
bootres <- purrr::map(bootres, ~ .x %>% dplyr::left_join(rlhat_Kblock,
by = c("refGMST", "Year")))
bootres
Tyrl
estim_Kblock
estim_Kblock$V2
dplyr::tibble(var_hat =
slbm::estimate_var_rl(theta = estim_Kblock$mle, Tyrl = .x, type = type,
ref_gmst = ref_gmst, Covmat = estim_Kblock$V2, rel_trend = add.args$rel_trend),
refGMST = ref_gmst, Year = .x) })
# compute variance of RL estimation on Kblock sample
varrl_V2 <- purrr::map_dfr(Tyrl, ~ {
dplyr::tibble(var_hat =
slbm::estimate_var_rl(theta = estim_Kblock$mle, Tyrl = .x, type = type,
ref_gmst = ref_gmst, Covmat = estim_Kblock$V2, rel_trend = add.args$rel_trend),
refGMST = ref_gmst, Year = .x) })
varrl_V2
bootres
# compute quantiles of the bootstrapped studentized RLs
tstar_quants_V2 <- bootres$resV2 %>%
dplyr::mutate(tstar = (rlboot - rl)/sqrt(var_hat)) %>%
dplyr::group_by(refGMST, Year) %>%
dplyr::summarise(q0975 = quantile(tstar, p = c(0.975), na.rm = TRUE),
q0025 = quantile(tstar, p = 0.025, na.rm = TRUE),
.groups = "drop")
# join results and compute confidence bounds
resV2 <- varrl_V2 %>%
dplyr::left_join(tstar_quants_V2, by = c("refGMST", "Year")) %>%
dplyr::left_join(rlhat_Kblock, by = c("refGMST", "Year")) %>%
dplyr::mutate(lower = rl - sqrt(var_hat)*q0975, upper = rl - sqrt(var_hat)*q0025)
# compute variance of RL estimation on Kblock sample
varrl_V <- purrr::map_dfr(Tyrl, ~ {
dplyr::tibble(var_hat =
slbm::estimate_var_rl(theta = estim_Kblock$mle, Tyrl = .x, type = type,
ref_gmst = ref_gmst, Covmat = estim_Kblock$V),
refGMST = ref_gmst, Year = .x) })
# compute quantiles of the bootstrapped studentized RLs
tstar_quants_V <- bootres$resV %>%
dplyr::mutate(tstar = (rlboot - rl)/sqrt(var_hat)) %>%
dplyr::group_by(refGMST, Year) %>%
dplyr::summarise(q0975 = quantile(tstar, p = c(0.975), na.rm = TRUE),
q0025 = quantile(tstar, p = 0.025, na.rm = TRUE),
.groups = "drop")
# join results and compute confidence bounds
resV <- varrl_V %>%
dplyr::left_join(tstar_quants_V, by = c("refGMST", "Year")) %>%
dplyr::left_join(rlhat_Kblock, by = c("refGMST", "Year")) %>%
dplyr::mutate(lower = rl - sqrt(var_hat)*q0975, upper = rl - sqrt(var_hat)*q0025)
res <- resV %>% dplyr::mutate(varmeth = "V") %>%
dplyr::bind_rows(resV2 %>% dplyr::mutate(varmeth = "V2"))
res
devtools::load_all()
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "V2")
add.args <- list(...)
# RL estimated on kblock sample
rlhat_Kblock <- slbm::compute_rl(theta = estim_Kblock$mle,
Tyrl = Tyrl, type = type, ref_gmst = ref_gmst, rel_trend = add.args$rel_trend)
bootres <- purrr::map(bootres, ~ dplyr::rename(.x, "rlboot" = "rl"))
bootres <- purrr::map(bootres, ~ .x %>% dplyr::left_join(rlhat_Kblock,
by = c("refGMST", "Year")))
compute_quants_boot(bootres = bootres,  Tyrl = Tyrl, estim_Kblock = estim_Kblock,
type = type, ref_gmst = ref_gmst, Covmat = Covmat$V2, conf.level = conf.level)
compute_quants_boot(bootres = bootres,  Tyrl = Tyrl, estim_Kblock = estim_Kblock,
type = type, ref_gmst = ref_gmst, Covmat = estim_Kblock$V2, conf.level = conf.level)
compute_quants_boot <- function(bootres, Tyrl, estim_Kblock, type, ref_gmst, Covmat, conf.level) {
browser()
# compute variance of RL estimation on Kblock sample
varrl <- purrr::map_dfr(Tyrl, ~ {
dplyr::tibble(var_hat =
slbm::estimate_var_rl(theta = estim_Kblock$mle, Tyrl = .x, type = type,
ref_gmst = ref_gmst, Covmat = Covmat),
refGMST = ref_gmst, Year = .x) })
# compute quantiles of the bootstrapped studentized RLs
tstar_quants <- bootres %>%
dplyr::mutate(tstar = (rlboot - rl)/sqrt(var_hat)) %>%
dplyr::group_by(refGMST, Year) %>%
dplyr::summarise(qupp = quantile(tstar, p = c(1-conf.level/2), na.rm = TRUE),
qlow = quantile(tstar, p = conf.level/2, na.rm = TRUE),
.groups = "drop")
# join results and compute confidence bounds
res <- varrl %>%
dplyr::left_join(tstar_quants, by = c("refGMST", "Year")) %>%
dplyr::left_join(rlhat_Kblock, by = c("refGMST", "Year")) %>%
dplyr::mutate(lower = rl - sqrt(var_hat)*qupp, upper = rl - sqrt(var_hat)*qlow)
res
}
devtools::load_all()
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "V2")
bootres
# compute variance of RL estimation on Kblock sample
varrl <- purrr::map_dfr(Tyrl, ~ {
dplyr::tibble(var_hat =
slbm::estimate_var_rl(theta = estim_Kblock$mle, Tyrl = .x, type = type,
ref_gmst = ref_gmst, Covmat = Covmat),
refGMST = ref_gmst, Year = .x) })
varrl
bootres
# compute quantiles of the bootstrapped studentized RLs
tstar_quants <- bootres %>%
dplyr::mutate(tstar = (rlboot - rl)/sqrt(var_hat)) %>%
dplyr::group_by(refGMST, Year) %>%
dplyr::summarise(qupp = quantile(tstar, p = c(1-conf.level/2), na.rm = TRUE),
qlow = quantile(tstar, p = conf.level/2, na.rm = TRUE),
.groups = "drop")
# compute quantiles of the bootstrapped studentized RLs
tstar_quants <- bootres$resV2 %>%
dplyr::mutate(tstar = (rlboot - rl)/sqrt(var_hat)) %>%
dplyr::group_by(refGMST, Year) %>%
dplyr::summarise(qupp = quantile(tstar, p = c(1-conf.level/2), na.rm = TRUE),
qlow = quantile(tstar, p = conf.level/2, na.rm = TRUE),
.groups = "drop")
devtools::load_all()
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
devtools::load_all()
devtools::load_all()AS
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
devtools::load_all()
devtools::load_all()
DFAÃ–
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "V2")
bootres
Covmat
# compute variance of RL estimation on Kblock sample
varrl <- purrr::map_dfr(Tyrl, ~ {
dplyr::tibble(var_hat =
slbm::estimate_var_rl(theta = estim_Kblock$mle, Tyrl = .x, type = type,
ref_gmst = ref_gmst, Covmat = Covmat),
refGMST = ref_gmst, Year = .x) })
# compute quantiles of the bootstrapped studentized RLs
tstar_quants <- bootres %>%
dplyr::mutate(tstar = (rlboot - rl)/sqrt(var_hat)) %>%
dplyr::group_by(refGMST, Year) %>%
dplyr::summarise(qupp = quantile(tstar, p = c(1-conf.level/2), na.rm = TRUE),
qlow = quantile(tstar, p = conf.level/2, na.rm = TRUE),
.groups = "drop")
conf.level <- 0.05
# compute quantiles of the bootstrapped studentized RLs
tstar_quants <- bootres %>%
dplyr::mutate(tstar = (rlboot - rl)/sqrt(var_hat)) %>%
dplyr::group_by(refGMST, Year) %>%
dplyr::summarise(qupp = quantile(tstar, p = c(1-conf.level/2), na.rm = TRUE),
qlow = quantile(tstar, p = conf.level/2, na.rm = TRUE),
.groups = "drop")
tstar_quants
# join results and compute confidence bounds
res <- varrl %>%
dplyr::left_join(tstar_quants, by = c("refGMST", "Year")) %>%
dplyr::left_join(rlhat_Kblock, by = c("refGMST", "Year")) %>%
dplyr::mutate(lower = rl - sqrt(var_hat)*qupp, upper = rl - sqrt(var_hat)*qlow)
res
varrl
# join results and compute confidence bounds
res <- varrl %>%
dplyr::left_join(tstar_quants, by = c("refGMST", "Year")) %>%
dplyr::left_join(rlhat_Kblock, by = c("refGMST", "Year")) %>%
dplyr::mutate(lower = rl - sqrt(var_hat)*qupp, upper = rl - sqrt(var_hat)*qlow)
devtools::load_all()
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "V2")
# compute variance of RL estimation on Kblock sample
varrl <- purrr::map_dfr(Tyrl, ~ {
dplyr::tibble(var_hat =
slbm::estimate_var_rl(theta = estim_Kblock$mle, Tyrl = .x, type = type,
ref_gmst = ref_gmst, Covmat = Covmat),
refGMST = ref_gmst, Year = .x) })
# compute quantiles of the bootstrapped studentized RLs
tstar_quants <- bootres %>%
dplyr::mutate(tstar = (rlboot - rl)/sqrt(var_hat)) %>%
dplyr::group_by(refGMST, Year) %>%
dplyr::summarise(qupp = quantile(tstar, p = c(1-conf.level/2), na.rm = TRUE),
qlow = quantile(tstar, p = conf.level/2, na.rm = TRUE),
.groups = "drop")
# join results and compute confidence bounds
res <- varrl %>%
dplyr::left_join(tstar_quants, by = c("refGMST", "Year")) %>%
dplyr::left_join(rlhat_Kblock, by = c("refGMST", "Year")) %>%
dplyr::mutate(lower = rl - sqrt(var_hat)*qupp, upper = rl - sqrt(var_hat)*qlow)
conf.level
conf.level
conf.level
devtools::load_all()
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "V2")
conf.level
conf.level <- 0.05
# compute variance of RL estimation on Kblock sample
varrl <- purrr::map_dfr(Tyrl, ~ {
dplyr::tibble(var_hat =
slbm::estimate_var_rl(theta = estim_Kblock$mle, Tyrl = .x, type = type,
ref_gmst = ref_gmst, Covmat = Covmat),
refGMST = ref_gmst, Year = .x) })
# compute quantiles of the bootstrapped studentized RLs
tstar_quants <- bootres %>%
dplyr::mutate(tstar = (rlboot - rl)/sqrt(var_hat)) %>%
dplyr::group_by(refGMST, Year) %>%
dplyr::summarise(qupp = quantile(tstar, p = c(1-conf.level/2), na.rm = TRUE),
qlow = quantile(tstar, p = conf.level/2, na.rm = TRUE),
.groups = "drop")
tstar_quants
# join results and compute confidence bounds
res <- varrl %>%
dplyr::left_join(tstar_quants, by = c("refGMST", "Year")) %>%
dplyr::left_join(rlhat_Kblock, by = c("refGMST", "Year")) %>%
dplyr::mutate(lower = rl - sqrt(var_hat)*qupp, upper = rl - sqrt(var_hat)*qlow)
res
devtools::load_all()
devtools::load_all()
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "both")
bootres
estim_Kblock
purrr::map2(.x = bootres, .y = list(estim_Kblock$V, estim_Kblock$V2),
~ compute_quants_boot(bootres = .x,  Tyrl = Tyrl, estim_Kblock = estim_Kblock,
rlhat_Kblock = rlhat_Kblock,
type = type, ref_gmst = ref_gmst, Covmat = .y, conf.level = conf.level))
bootres
devtools::load_all()
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "both")
paste0("q", c(1,2))
devtools::load_all()
devtools::load_all()
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "both", estimate_RL = "both")
bootres
devtools::load_all()
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "both", estimate_RL = "both")
bootres
Covlist
purrr::map2(.x = bootres, .y = Covlist,
~ compute_quants_boot(bootres = .x,  Tyrl = Tyrl, estim_Kblock = estim_Kblock,
type = type, ref_gmst = ref_gmst, Covmat = .y, conf.level = conf.level, target = "Param"))
devtools::load_all()
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "both", estimate_RL = "both")
purrr::map2(.x = bootres, .y = Covlist,
~ compute_quants_boot(bootres = .x,  Tyrl = Tyrl, estim_Kblock = estim_Kblock,
type = type, ref_gmst = ref_gmst, Covmat = .y, conf.level = conf.level, target = "Param"))
devtools::load_all()
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "both", estimate_RL = "both")
devtools::load_all()
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "both", estimate_RL = "both")
res_K
resK$res_rl
res_K$res_rl
res_K$res_rl$resV
res_K$res_rl
names(res_K$res_rl)
names(res_K$res_rl)
?coerce
purrr::map_dfr(res_K$res_rl, .x)
purrr::map_dfr(res_K$res_rl, ~ .x)
purrr::map_dfr(res_K$res_rl, ~ .x %>% mutate(varmeth = names(.x)))
purrr::map_dfr(res_K$res_rl, ~ {.x %>% mutate(varmeth = names(.x))})
purrr::map2_dfr(res_K$res_rl, names(res_K$res_rl),  ~ .x %>% mutate(varmeth = .y))
devtools::load_all()
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "both", estimate_RL = "both")
paramest <- paramest %>%
dplyr::bind_rows(res_K$res_params %>% dplyr::mutate( Kblock = k) )
rlest <- rlest %>%
dplyr::bind_rows(res_K$res_rl %>% dplyr::mutate(df_estim_Kblock, Kblock = k) )
res_K
paramest
rlest
rl_hat_full <- slbm::compute_rl(theta = est_sl$mle, Tyrl = Tyrl, type = type, ref_gmst = ref_gmst)
rl_hat_full <- slbm::compute_rl(theta = est_sl$mle, Tyrl = Tyrl, type = type, ref_gmst = ref_gmst,
rel_trend = add.args$rel_trend)
rl_hat_full <- dplyr::rename(rl_hat_full, "rlfull" = "rl")
rlest <- rlest %>% dplyr::left_join(rl_hat_full, by = c("refGMST", "Year"))
rlest
list(res_params  = paramest,
res_rl  = rlest)
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz),
B = 10, type = "shift", ref_gmst = c(0.5, 0.95), varmeth = "both", estimate_RL = "both")
paramest <- paramest %>%
dplyr::bind_rows(res_K$res_params %>% dplyr::mutate( Kblock = k) )
rlest <- rlest %>%
dplyr::bind_rows(res_K$res_rl %>% dplyr::mutate(df_estim_Kblock, Kblock = k) )
rl_hat_full <- slbm::compute_rl(theta = est_sl$mle, Tyrl = Tyrl, type = type, ref_gmst = ref_gmst)
rl_hat_full <- dplyr::rename(rl_hat_full, "rlfull" = "rl")
rlest <- rlest %>% dplyr::left_join(rl_hat_full, by = c("refGMST", "Year"))
list(res_params  = paramest,
res_rl  = rlest)
devtools::load_all()
yy <- evd::rgpd(ny*blcksz, shape = 0.2)*exp(2/7.3*rep(1:ny/ny, each = blcksz))
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz), B = 100, type = "scale", ref_gmst = c(0.5, 0.95), rel_trend = FALSE)
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz), B = 10, type = "scale", ref_gmst = c(0.5, 0.95), rel_trend = FALSE)
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz), B = 10, type = "scale", ref_gmst = c(0.5, 0.95), rel_trend = FALSE, Kblock = 4)
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz), B = 10, type = "scale", ref_gmst = c(0.5, 0.95), rel_trend = FALSE, Kblock = 5)
yy <- evd::rgpd(ny*blcksz, shape = 0.2)*exp(2*rep(1:ny/ny, each = blcksz))
plot.ts(yy)
yy <- evd::rgpd(ny*blcksz, shape = 0.2)*exp(0.5*rep(1:ny/ny, each = blcksz))
plot.ts(yy)
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz), B = 10, type = "scale", ref_gmst = c(0.5, 0.95), rel_trend = FALSE, Kblock = 5)
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz), B = 10, type = "stationary",rel_trend = FALSE, Kblock = 5)
devtools::load_all()
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz), B = 10, type = "stationary",rel_trend = FALSE, Kblock = 5)
devtools::load_all()
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz), B = 10, type = "stationary",rel_trend = FALSE, Kblock = 5)
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz), B = 10, type = "stationary", rel_trend = FALSE, Kblock = 5, varmeth = "both")
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz), B = 10, type = "stationary", rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "both")
ci_student_boot_sl(yy, blcksz = 90, temp.cov = rep(1:ny/ny, each = blcksz), B = 10, type = "stationary", rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "both", conf.level = .01)
blcksz <- 183
xx <- dailyPrec %>% filter(lubridate::month(Date) %in% 4:9,
lubridate::year(Date) >= 1950)
gmst <- GMST %>% filter(Year >= 1950, Year <= 2010)
bms <- get_uniq_bm(xx$cumPrec, blcksz, temp_cvrt = rep(gmst$smoothedGMST, each = blcksz) , looplastblock = FALSE)
# full sample of sliding for estimaing the covariance matrix
slbm <- blockmax(xx$cumPrec, r = blcksz, "sliding")
estim <- fit_gev_univ(data = bms, type = "scale", hessian = TRUE, rel_trend = FALSE)
estim
bb <- score.fun(slbm, theta = estim$mle, temp.cov = rep(gmst$smoothedGMST, each = blcksz)[1:length(slbm)],
type = "scale", chain = TRUE, rel_trend = FALSE)
cvrt_sl <- rep(gmst$smoothedGMST, each = blcksz)[1:length(slbm)]
est_var_chain(orig_slbm = slbm, est_par =  estim, blcksz =  blcksz,
temp.cov = rep(gmst$smoothedGMST, each = blcksz)[1:length(slbm)],
type = "scale", varmeth = "both", rel_trend = FALSE)
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 10, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "both", conf.level = .01)
devtools::load_all()
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 10, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "both", conf.level = .01)
devtools::load_all()
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 10, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "both", conf.level = .01)
devtools::load_all()
devtools::load_all()
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 10, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "both", conf.level = .01)
rlang::last_error()
devtools::load_all()
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 10, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "both", conf.level = .01)
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 10, type = "shift",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "both", conf.level = .01)
blcksz
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 10, type = "shift",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = TRUE, conf.level = .01)
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "shift",
rel_trend = FALSE, Kblock = 5, varmeth = "V2", estimate_RL = TRUE, conf.level = .01)
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "stationary",
rel_trend = FALSE, Kblock = 5, varmeth = "V2", estimate_RL = TRUE, conf.level = .01)
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "stationary",
rel_trend = FALSE, Kblock = 5, varmeth = "V2", estimate_RL = TRUE, conf.level = .01, Tyrl = c(50, 100))
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "shift",
rel_trend = FALSE, Kblock = 5, varmeth = "V2", estimate_RL = TRUE, conf.level = .01, Tyrl = c(50, 100))
devtools::load_all()
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "shift",
rel_trend = FALSE, Kblock = 5, varmeth = "V2", estimate_RL = TRUE, conf.level = .01, Tyrl = c(50, 100))
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "shift",
rel_trend = FALSE, Kblock = 5, varmeth = "V2", estimate_RL = "both", conf.level = .01, Tyrl = c(50, 100))
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "shift",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "both", conf.level = .01, Tyrl = c(50, 100))
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "shift",
rel_trend = FALSE, Kblock = 5, varmeth = "V2", estimate_RL = "both", conf.level = .01, Tyrl = c(50, 100))
devtools::load_all()
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "shift",
rel_trend = FALSE, Kblock = 5, varmeth = "V2", estimate_RL = "both", conf.level = .01, Tyrl = c(50, 100))
Covlist
bootres
devtools::load_all()
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "shift",
rel_trend = FALSE, Kblock = 5, varmeth = "V2", estimate_RL = "both", conf.level = .01, Tyrl = c(50, 100))
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "shift",
rel_trend = FALSE, Kblock = 5, varmeth = "V", estimate_RL = "both", conf.level = .01, Tyrl = c(50, 100))
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "shift",
rel_trend = FALSE, Kblock = 5, varmeth = "V", estimate_RL = "FALSE", conf.level = .01, Tyrl = c(50, 100))
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "shift",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "FALSE", conf.level = .01, Tyrl = c(50, 100))
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "shift",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "both", conf.level = .01, Tyrl = c(50, 100))
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "both", conf.level = .01, Tyrl = c(50, 100))
est_sl
View(df_estim_Kblock)
fit_gev_univ(data = bms, hessian = TRUE, type = "shift", return_cov = TRUE,
varmeth = "V2", chain = TRUE, orig_slbm = blockmax(xx, 90, "sliding"),
orig_cvrt = temp_cvrt)
xx <- evd::rgpd(100*90, shape = 0.2)
# define a temporal covariate that is constant over a block of length blcksz
temp_cvrt <- rep(1:100/100, each = blcksz)[1:(99*blcksz + 1)]
bms <- get_uniq_bm(xx, blcksz, temp_cvrt = temp_cvrt, looplastblock = FALSE)
bms
fit_gev_univ(data = bms, hessian = TRUE, type = "shift", return_cov = TRUE,
varmeth = "V2", chain = TRUE, orig_slbm = blockmax(xx, 90, "sliding"),
orig_cvrt = temp_cvrt)
fit_gev_univ(data = bms, hessian = TRUE, type = "shift", return_cov = TRUE,
varmeth = "V2", chain = TRUE, orig_slbm = blockmax(xx, 90, "sliding"),
orig_cvrt = temp_cvrt)
fit_gev_univ(data = bms, hessian = TRUE, type = "shift", return_cov = TRUE,
orig_cvrt = temp_cvrt)
fit_gev_univ(data = bms, hessian = TRUE, type = "shift", return_cov = TRUE,
varmeth = "V2", chain = TRUE, orig_slbm = blockmax(xx, 90, "sliding"),
orig_cvrt = temp_cvrt, blcksz = 90)
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "FALSE", conf.level = .01, Tyrl = c(50, 100))
blcksz <- 183
xx <- dailyPrec %>% filter(lubridate::month(Date) %in% 4:9,
lubridate::year(Date) >= 1950)
gmst <- GMST %>% filter(Year >= 1950, Year <= 2010)
bms <- get_uniq_bm(xx$cumPrec, blcksz, temp_cvrt = rep(gmst$smoothedGMST, each = blcksz) , looplastblock = FALSE)
# full sample of sliding for estimaing the covariance matrix
slbm <- blockmax(xx$cumPrec, r = blcksz, "sliding")
estim <- fit_gev_univ(data = bms, type = "scale", hessian = TRUE, rel_trend = FALSE)
estim
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "FALSE", conf.level = .01, Tyrl = c(50, 100))
devtools::load_all()
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "FALSE", conf.level = .01, Tyrl = c(50, 100))
rlang::last_error()
devtools::load_all()
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "FALSE", conf.level = .01, Tyrl = c(50, 100))
devtools::load_all()
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "FALSE", conf.level = .01, Tyrl = c(50, 100))
devtools::load_all()
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "FALSE", conf.level = .01, Tyrl = c(50, 100))
devtools::load_all()
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "FALSE", conf.level = .01, Tyrl = c(50, 100))
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "FALSE", conf.level = .01, Tyrl = c(50, 100))
boot_estimators
boot_parest <- purrr::map_dfr(boot_estimators, ~ dplyr::tibble(
data.frame(t(.x$mle), conv = .x$conv),
CovestV = list(.x$V), CovestV2 = list(.x$V2)))
boot_parest
boot_parest <- purrr::map_dfr(boot_estimators, ~ dplyr::tibble(
data.frame(t(.x$mle), conv = .x$conv),
CovestV = list(.x$V)))
boot_parest
boot_parest <- list(resV =
purrr::map_dfr(boot_estimators, ~ dplyr::tibble(
data.frame(t(.x$mle), conv = .x$conv),
CovestV = list(.x$V))),
resV2 = purrr::map_dfr(boot_estimators, ~ dplyr::tibble(
data.frame(t(.x$mle), conv = .x$conv),
CovestV = list(.x$V2))))
boot_parest
devtools::load_all()
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "FALSE", conf.level = .01, Tyrl = c(50, 100))
target
add.args <- list(...)
# lenght of time series (of daily observations given in yy)
ndata <- length(yy)
djbm <- slbm::blockmax(yy, r = blcksz, "disjoint")
# compute the unique sliding BM and their frequency
df.yy <- data.frame(Station = "X1", Obs = yy)
sluniq_comp <- slbm::get_uniq_bm(yy, blcksz = blcksz, temp_cvrt = temp.cov,
looplastblock = FALSE)
slbm_orig <- slbm::blockmax(yy, r = blcksz, "sliding")
bootres
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "FALSE", conf.level = .01, Tyrl = c(50, 100))
# compute variance of RL estimation on Kblock sample
par_vars <- diag(Covmat)
parsK <- as.data.frame(t(estim_Kblock$mle))
bootpars <-  bootres %>%  dplyr::select(mu, sigma, shape, alpha, CovestV) %>% unique()
tstar_pars <- bootpars %>% dplyr::mutate( star =
purrr::pmap(list(mu, sigma, shape, alpha, CovestV),
function(mu, sigma, shape, alpha, CovestV) {
dplyr::tibble((mu - parsK["mu"])/sqrt(CovestV[1,1]),
(sigma - parsK["sigma"])/sqrt(CovestV[2,2]),
(shape - parsK["shape"])/sqrt(CovestV[3,3]),
(alpha - parsK["alpha"])/sqrt(CovestV[4,4]))
}))
n.par <- 4
# compute quantiles of the bootstrapped studentized parameter estimates
tstar_pars_quants <- tstar_pars %>% dplyr::select(star) %>% tidyr::unnest(cols = star) %>%
dplyr::summarise_at(1:n.par,  ~ quantile(.x, p = c( 1 - conf.level/2, conf.level/2), na.rm = TRUE)) %>%
dplyr::mutate(quant = paste0("q", c( 1 - conf.level/2, conf.level/2)))
lower_bounds <- (parsK - sqrt(par_vars) * tstar_pars_quants[1, 1:n.par]) %>%
tidyr::pivot_longer(cols = 1:n.par,
names_to = "parameter", values_to = "lower")
upper_bounds <- (parsK - sqrt(par_vars) * tstar_pars_quants[2, 1:n.par]) %>%
tidyr::pivot_longer(cols = 1:n.par,
names_to = "parameter", values_to = "upper")
parsK <- tidyr::pivot_longer(parsK, cols = 1:n.par, names_to = "parameter", values_to = "par_est")
res_pars <- parsK %>% dplyr::left_join(lower_bounds, by = "parameter") %>%
dplyr::left_join(upper_bounds, by = "parameter")
res_pars
devtools::load_all()
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "both", estimate_RL = "FALSE", conf.level = .01, Tyrl = c(50, 100))
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "V", estimate_RL = "FALSE", conf.level = .01, Tyrl = c(50, 100))
ci_student_boot_sl(xx$cumPrec, blcksz = 183, temp.cov = rep(gmst$smoothedGMST, each = blcksz), B = 2, type = "scale",
rel_trend = FALSE, Kblock = 5, varmeth = "V2", estimate_RL = "FALSE", conf.level = .01, Tyrl = c(50, 100))
